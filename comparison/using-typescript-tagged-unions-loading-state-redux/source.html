<div id="__next"><div class="flex flex-row"><div class="print:hidden h-screen w-0 xl:w-88" style="width: 352px;"><header class="flex flex-col print:hidden fixed h-screen overflow-hidden w-inherit"><div class="h-screen overflow-hidden relative"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="background image" sizes="100vw" srcset="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;object-position:center center"><noscript><img alt="background image" sizes="100vw" srcSet="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;object-position:center center" loading="lazy"/></noscript></span></div><div class="absolute bg-etched rounded-lg text-center inline-flex lg:flex flex-row items-center justify-center lg:justify-start w-full max-w-xs sm:max-w-sm lg:max-w-md pin-center -mt-8 m-auto w-full"><div class="flex flex-row items-center justify-center w-full p-2"><div class="w-0 lg:w-48 h-48 rounded-full overflow-hidden flex-grow-0 transition-width ease-in-out lg:w-0"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="></span><img alt="avatar" srcset="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=384&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"><noscript><img alt="avatar" srcSet="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=384&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="font-muli lg:ml-5 flex-grow"><div class="text-4xl lg:text-5xl font-bold font-muli mb-3" data-typeit-id="0019889">James DiGioia<span class="ti-cursor" style="visibility: hidden;"></span></div><div class="text-xl md:text-3xl mb-3 flex flex-row align-center justify-center text-center"><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://www.facebook.com/james.digioia" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-4xl" style="color:#3b5998" alt="Facebook" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://www.linkedin.com/in/jamesdigioia" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-4xl" style="color:#4875b4" alt="LinkedIn" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://github.com/mAAdhaTTah/" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-4xl" style="color:#333" alt="GitHub" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></div><div class="relative text-xl lg:text-3xl" data-typeit-id="0794296">my little web home<span class="ti-cursor" style="visibility: hidden;"></span></div></div></div></div></header><div class="fixed top-2 left-2 z-50"><button class="rounded-full bg-darkg text-secondary p-1 border-2 border-darkg focus:outline-none focus:border-lightg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-lg" alt="" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg><div style="border:0;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;margin:0 -1px -1px 0;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap">Open menu</div></button></div></div><div class="relative flex-grow"><div style="opacity:1" class="absolute w-full"><article class="p-5 flow-root rounded pb-3 mb-5 max-w-xl mx-auto bg-primary"><header class="relative mb-5"><img src="https://static.jamesdigioia.com/uploads/2019/06/union-types-traffic-lights.png" alt="Union types described as a traffic light" class=""><div class="absolute pin-x-center pin-y-bottom w-full bg-etched rounded p-5"><div class="text-center"><h1 class="text-4xl text-lightg font-muli mb-5">Using TypeScript tagged unions for loading state in Redux</h1></div><div class="flex justify-center"><div class="flex-grow-0 entry-meta my-2 flex items-center rounded bg-secondary p-3 mb-3"><time class="font-body published" datetime="2019-07-01T14:40:36">July 1st, 2019</time><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mx-3 w-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><p class="font-body">James DiGioia</p></div></div></div></header><section class="max-w-prose"><p class="font-ovo text-xl leading-normal pb-3">Dealing with loading state is a core requirement of most apps you build. Every app needs data, that data almost always needs to be loaded from somewhere, so you need to manage your loading state. Redux doesn’t provide any particular structure for this, but combining it with TypeScript enables some useful patterns. Let’s take a look at a few ways of handling it, some downsides to those approaches, and conclude with an approach I’ve used successfully on a few projects.</p>
<p class="font-ovo text-xl leading-normal pb-3">We’ll be using TypeScript throughout the examples, but much of the concepts here are useful without the types. The TypeScript-specific content comes towards the end, so I would encourage JavaScript-only developers to read through to the end. Even if you don’t use TS, the concepts applied with it can be applied with JS as well.</p>
<h2 class="mb-5 font-muli text-3xl">Naive Approach</h2>
<p class="font-ovo text-xl leading-normal pb-3">The most common structure you’ll see for this looks like this:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="array-state.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">State</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span>Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>defaultState<span class="token operator">:</span><span class="token space"> </span>State<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>array-state.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">This seems pretty simple; start with an empty array, add additional items to the <code class="whitespace-nowrap">items</code> keys when you fetch them, and you simplify the checks in your views. But we’ve already got a problem: there’s no distinction between "haven’t loaded any items" and "successfully loaded no items". This <em>can</em> work for some apps, if they’re really simple or they die on load failure (like a CLI app), but for most of your typical web apps, this is going to be a problem.</p>
<p class="font-ovo text-xl leading-normal pb-3">So let’s toss in a <code class="whitespace-nowrap">null</code> instead to indicate that the items haven’t been loaded yet:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="wp-gistpen-error">ID provided is not a Gistpen repo.</div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">So now we can tell the difference between whether things are loaded or not: if <code class="whitespace-nowrap">state.items === null</code>, they’ve been loaded. So far so good.</p>
<p class="font-ovo text-xl leading-normal pb-3">But what happens if the server errors? We can’t represent an error state with this setup. How do we do that?</p>
<h2 class="mb-5 font-muli text-3xl">Handling error &amp; loading states</h2>
<p class="font-ovo text-xl leading-normal pb-3">We could solve this by adding an error key to the state:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="array-error-state.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">State</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span>Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span>Error<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>initialState<span class="token operator">:</span><span class="token space"> </span>State<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>successState<span class="token operator">:</span><span class="token space"> </span>State<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span>response<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>errorState<span class="token operator">:</span><span class="token space"> </span>State<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span>response<span class="token punctuation">.</span>error<span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>array-error-state.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">This allows us to represent the initial, loaded &amp; error states, with the examples above expressing those possibilities. It is a bit onerous to derive those states though. You have to check both of the values in order to figure out where you’re at, because at the "unloaded" step, both are <code class="whitespace-nowrap">null</code>. A conditional check could look like this:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="array-error-conditional.ts"><code class="language-typescript"><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>items<span class="token space"> </span><span class="token operator">===</span><span class="token space"> </span><span class="token keyword">null</span><span class="token space"> </span><span class="token operator">&amp;&amp;</span><span class="token space"> </span>state<span class="token punctuation">.</span>error<span class="token space"> </span><span class="token operator">===</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>UnloadedView<span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>items<span class="token space"> </span><span class="token operator">!==</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>LoadedView<span class="token space"> </span>items<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>items<span class="token punctuation">}</span><span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token comment">//<span class="token space"> </span>We<span class="token space"> </span>can<span class="token space"> </span>assume<span class="token space"> </span>we're<span class="token space"> </span>in<span class="token space"> </span>the<span class="token space"> </span>error<span class="token space"> </span>state<span class="token space"> </span>now</span><span class="token lf">
</span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>ErrorView<span class="token space"> </span>error<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>error<span class="token punctuation">}</span><span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>array-error-conditional.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">There are various ways of structuring this conditional, and all of them are variously ugly in their own particular way. You could extract these conditionals to functions, which would at least give them readable names.</p>
<p class="font-ovo text-xl leading-normal pb-3">However, this sate can’t tell us whether the API request has started or not. If this is a case where the API request starts immediately, then the difference is immaterial to the view. But if you need this information, you could add <em>another</em> property to indicate whether the request is loading or not:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="array-error-loading.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">State</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>loading<span class="token operator">:</span><span class="token space"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span>Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span>Error<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>defaultState<span class="token operator">:</span><span class="token space"> </span>State<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>loading<span class="token operator">:</span><span class="token space"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>array-error-loading.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">And the conditional complicates accordingly:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="array-error-loading-conditional.ts"><code class="language-typescript"><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>LoadingView<span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>items<span class="token space"> </span><span class="token operator">===</span><span class="token space"> </span><span class="token keyword">null</span><span class="token space"> </span><span class="token operator">&amp;&amp;</span><span class="token space"> </span>state<span class="token punctuation">.</span>error<span class="token space"> </span><span class="token operator">===</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>UnloadedView<span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>items<span class="token space"> </span><span class="token operator">!==</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>LoadedView<span class="token space"> </span>items<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>items<span class="token punctuation">}</span><span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>ErrorView<span class="token space"> </span>error<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>error<span class="token punctuation">}</span><span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>array-error-loading-conditional.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<h2 class="mb-5 font-muli text-3xl">Unionize!</h2>
<p class="font-ovo text-xl leading-normal pb-3">But let’s take a step back: we’re really trying to represent various states of the API request by checking the effects of the requests. Instead, we should just represent the current loading state explicitly:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="status-state.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">State</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>status<span class="token operator">:</span><span class="token space"> </span><span class="token string">'unloaded'</span><span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token string">'loading'</span><span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token string">'loaded'</span><span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token string">'error'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span>Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span>Error<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>defaultState<span class="token operator">:</span><span class="token space"> </span>State<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>status<span class="token operator">:</span><span class="token space"> </span><span class="token string">'unloaded'</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span><span class="token keyword">null</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>status-state.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">Now, we have all of our states represented by string, indicating exactly what state the API is in. The conditional itself gets simplified as well: we can now use a <code class="whitespace-nowrap">switch</code> statement to exhaust all possible states:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="status-conditional.ts"><code class="language-typescript"><span class="token keyword">switch</span><span class="token space"> </span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">case</span><span class="token space"> </span><span class="token string">'unloaded'</span><span class="token operator">:</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>UnloadedView<span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">case</span><span class="token space"> </span><span class="token string">'loading'</span><span class="token operator">:</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>LoadingView<span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">case</span><span class="token space"> </span><span class="token string">'loaded'</span><span class="token operator">:</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>LoadedView<span class="token space"> </span>items<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>items<span class="token punctuation">}</span><span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">case</span><span class="token space"> </span><span class="token string">'error'</span><span class="token operator">:</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token operator">&lt;</span>ErrorView<span class="token space"> </span>error<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>error<span class="token punctuation">}</span><span class="token space"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>status-conditional.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">Now we’re talking! There’s a very clear mapping between the various states and their related views, and you know that if you’re in an error state or a loaded state, what data is available to you: error state always has an error object, loaded state always has the array of items, and the loaded view itself could display a "no items found" if the array is empty.</p>
<p class="font-ovo text-xl leading-normal pb-3">This approach is easily extensible as well. You can add <code class="whitespace-nowrap">'reloading'</code> and <code class="whitespace-nowrap">'reload-error'</code> states, in case you need to refresh data while displaying the stale data at the same time. It’s much more powerful and flexible than adding random keys and hoping you can continue to figure out what’s happening based on the data you have.</p>
<p class="font-ovo text-xl leading-normal pb-3">In JavaScript, there isn’t much more to be done. Since you don’t have to write up the types in any meaningful way, you know that when <code class="whitespace-nowrap">status === 'loaded'</code>, <code class="whitespace-nowrap">state.items</code> is the array of items, and you could move on. But if you’re using TypeScript, you’ll need to represent that relationship in the type system. In fact, the above example will error in TypeScript, as <code class="whitespace-nowrap">state.items</code> could be <code class="whitespace-nowrap">null</code>. We can solve this with tagged unions.</p>
<h3 class="mb-5 font-muli text-2xl">Tagged unions</h3>
<p class="font-ovo text-xl leading-normal pb-3">Let’s start by looking at tagged unions. A tagged union allows us to combine two types and discriminate between them with a tagged property.</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="tagged-union.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">First</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>tag<span class="token operator">:</span><span class="token space"> </span><span class="token string">'first'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>prop<span class="token operator">:</span><span class="token space"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">Second</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>tag<span class="token operator">:</span><span class="token space"> </span><span class="token string">'second'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>value<span class="token operator">:</span><span class="token space"> </span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">FirstOrSecond</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span>First<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span>Second<span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">declare</span><span class="token space"> </span><span class="token keyword">function</span><span class="token space"> </span><span class="token function">getFirstOrSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token space"> </span>FirstOrSecond<span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>thing<span class="token operator">:</span><span class="token space"> </span>FirstOrSecond<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token function">getFirstOrSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">switch</span><span class="token space"> </span><span class="token punctuation">(</span>thing<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">case</span><span class="token space"> </span><span class="token string">'first'</span><span class="token operator">:</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>TypeScript<span class="token space"> </span>knows<span class="token space"> </span>prop<span class="token space"> </span>exists<span class="token space"> </span>and<span class="token space"> </span>is<span class="token space"> </span>a<span class="token space"> </span>number.</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>Accessing<span class="token space"> </span>thing.value<span class="token space"> </span>would<span class="token space"> </span>cause<span class="token space"> </span>an<span class="token space"> </span>error.</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span>thing<span class="token punctuation">.</span>prop<span class="token space"> </span><span class="token operator">+</span><span class="token space"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">case</span><span class="token space"> </span><span class="token string">'second'</span><span class="token operator">:</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>And<span class="token space"> </span>value<span class="token space"> </span>exists<span class="token space"> </span>and<span class="token space"> </span>is<span class="token space"> </span>a<span class="token space"> </span>string<span class="token space"> </span>here</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span>thing<span class="token punctuation">.</span>value<span class="token space"> </span><span class="token operator">+</span><span class="token space"> </span><span class="token string">'<span class="token space"> </span>came<span class="token space"> </span>in<span class="token space"> </span>second'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>tagged-union.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">We’ve created a union type, <code class="whitespace-nowrap">FirstOrSecond</code>, from two types with an overlapping property, <code class="whitespace-nowrap">tag</code>. The types can have any additional properties they’d like, as long as there’s one overlapping property, with a constant of some kind, that TypeScript can use to discriminate between the types. Actions in Redux, with their <code class="whitespace-nowrap">type</code> property, are another common example of this, and <a class="no-underline border-b-2 border-darkg" href="https://github.com/piotrwitek/typesafe-actions">typesafe-actions</a> makes it easy to implement in that case.</p>
<p class="font-ovo text-xl leading-normal pb-3">However, <strong>this does not work with random properties.</strong> It’s a common complaint people have: if you have a union type where the dependent types have no overlapping properties, you can’t check for the existence of one of those properties to determine which type you’re looking at it. This <strong>does not work:</strong></p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="union-fail.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">First</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>prop<span class="token operator">:</span><span class="token space"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">Second</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>value<span class="token operator">:</span><span class="token space"> </span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">FirstOrSecond</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span>First<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span>Second<span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">declare</span><span class="token space"> </span><span class="token keyword">function</span><span class="token space"> </span><span class="token function">getFirstOrSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token space"> </span>FirstOrSecond<span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">const</span><span class="token space"> </span>thing<span class="token operator">:</span><span class="token space"> </span>FirstOrSecond<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token function">getFirstOrSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token comment">//<span class="token space"> </span>TypeScript<span class="token space"> </span>complains<span class="token space"> </span>about<span class="token space"> </span>Second<span class="token space"> </span>not<span class="token space"> </span>having<span class="token space"> </span>a<span class="token space"> </span>`prop`<span class="token space"> </span>property.</span><span class="token lf">
</span><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token space"> </span>thing<span class="token punctuation">.</span>prop<span class="token space"> </span><span class="token operator">===</span><span class="token space"> </span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>TypeScript<span class="token space"> </span>does<span class="token space"> </span>not<span class="token space"> </span>know<span class="token space"> </span>you<span class="token space"> </span>have<span class="token space"> </span>a<span class="token space"> </span>First</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>without<span class="token space"> </span>an<span class="token space"> </span>explicit<span class="token space"> </span>cast</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">const</span><span class="token space"> </span>prop<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">(</span>thing<span class="token space"> </span><span class="token keyword">as</span><span class="token space"> </span>First<span class="token punctuation">)</span><span class="token punctuation">.</span>prop<span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token space"> </span><span class="token keyword">else</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">const</span><span class="token space"> </span>value<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">(</span>thing<span class="token space"> </span><span class="token keyword">as</span><span class="token space"> </span>Second<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>union-fail.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">Now that we understand what a tagged union type is, we can use this concept to tag our various loading state, and their associated properties:</p>
<p class="font-ovo text-xl leading-normal pb-3"></p><div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-typescript" data-filename="tagged-union-state.ts"><code class="language-typescript"><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">UnloadedState</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>status<span class="token operator">:</span><span class="token space"> </span><span class="token string">'unloaded'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">LoadingState</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>status<span class="token operator">:</span><span class="token space"> </span><span class="token string">'loading'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">LoadedState</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>status<span class="token operator">:</span><span class="token space"> </span><span class="token string">'loaded'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>items<span class="token operator">:</span><span class="token space"> </span>Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">ErrorState</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>status<span class="token operator">:</span><span class="token space"> </span><span class="token string">'error'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>error<span class="token operator">:</span><span class="token space"> </span>Error<span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">type</span><span class="token space"> </span><span class="token class-name">State</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span>UnloadedState<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span>LoadingState<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span>LoadedState<span class="token space"> </span><span class="token operator">|</span><span class="token space"> </span>ErrorState<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>tagged-union-state.ts</span></div></div></div></div><p class="font-ovo text-xl leading-normal pb-3"></p>
<p class="font-ovo text-xl leading-normal pb-3">Now, in the switch statement above, we <em>know</em>, at the type level, what properties are available to us. No more <code class="whitespace-nowrap">null</code> checking or ugly cast throughs–just a clean description of the various states and their associated and known-to-be-present properties.</p>
<h2 class="mb-5 font-muli text-3xl">Conclusion</h2>
<p class="font-ovo text-xl leading-normal pb-3">Next time you need to implement a data loading scheme, start off with a version of this, and it’ll make your data much easier to extend over time.</p>
</section></article></div></div></div></div>