<div id="__next"><div class="flex flex-row"><div class="print:hidden h-screen w-0 xl:w-88" style="width: 352px;"><header class="flex flex-col print:hidden fixed h-screen overflow-hidden w-inherit"><div class="h-screen overflow-hidden relative"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="background image" sizes="100vw" srcset="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;object-position:center center"><noscript><img alt="background image" sizes="100vw" srcSet="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;object-position:center center" loading="lazy"/></noscript></span></div><div class="absolute bg-etched rounded-lg text-center inline-flex lg:flex flex-row items-center justify-center lg:justify-start w-full max-w-xs sm:max-w-sm lg:max-w-md pin-center -mt-8 m-auto w-full"><div class="flex flex-row items-center justify-center w-full p-2"><div class="w-0 lg:w-48 h-48 rounded-full overflow-hidden flex-grow-0 transition-width ease-in-out lg:w-0"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="></span><img alt="avatar" srcset="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=384&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"><noscript><img alt="avatar" srcSet="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=384&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="font-muli lg:ml-5 flex-grow"><div class="text-4xl lg:text-5xl font-bold font-muli mb-3" data-typeit-id="4473192">James DiGioia<span class="ti-cursor" style="visibility: hidden;"></span></div><div class="text-xl md:text-3xl mb-3 flex flex-row align-center justify-center text-center"><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://www.facebook.com/james.digioia" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-4xl" style="color:#3b5998" alt="Facebook" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://www.linkedin.com/in/jamesdigioia" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-4xl" style="color:#4875b4" alt="LinkedIn" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://github.com/mAAdhaTTah/" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-4xl" style="color:#333" alt="GitHub" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></div><div class="relative text-xl lg:text-3xl" data-typeit-id="6458511">my little web home<span class="ti-cursor" style="visibility: hidden;"></span></div></div></div></div></header><div class="fixed top-2 left-2 z-50"><button class="rounded-full bg-darkg text-secondary p-1 border-2 border-darkg focus:outline-none focus:border-lightg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-lg" alt="" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg><div style="border:0;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;margin:0 -1px -1px 0;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap">Open menu</div></button></div></div><div class="relative flex-grow"><div style="opacity:1" class="absolute w-full"><article class="p-5 flow-root rounded pb-3 mb-5 max-w-xl mx-auto bg-primary"><header class="relative mb-5"><img src="https://static.jamesdigioia.com/uploads/2016/11/observable-universe-wikimedia.png" alt="the Observable Universe from WikiMedia" class=""><div class="absolute pin-x-center pin-y-bottom w-full bg-etched rounded p-5"><div class="text-center"><h1 class="text-4xl text-lightg font-muli mb-5">Using Observables to Control Render Scheduling</h1></div><div class="flex justify-center"><div class="flex-grow-0 entry-meta my-2 flex items-center rounded bg-secondary p-3 mb-3"><time class="font-body published" datetime="2016-11-07T12:17:08">November 7th, 2016</time><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mx-3 w-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><p class="font-body">James DiGioia</p></div></div></div></header><section class="max-w-prose"><p class="font-ovo text-xl leading-normal pb-3">When I talk to other developers about Observables, it’s often hard to explain their benefits because on the surface, they just look like glorified event emitters, but it’s how they <em>compose</em> that make handling dependencies between async events such a breeze. While working on the code snippet editor in <a class="no-underline border-b-2 border-darkg" href="https://github.com/mAAdhaTTah/WP-Gistpen">WP-Gistpen</a>, I came across an example that shows how easily Observables handle async behavior.</p>
<p class="font-ovo text-xl leading-normal pb-3">So here’s the setup: building a snippet editor on top of <a class="no-underline border-b-2 border-darkg" href="http://prismjs.com/">PrismJS</a> and borrowing some code from <a class="no-underline border-b-2 border-darkg" href="http://dabblet.com/">Dabblet</a>, both from <a class="no-underline border-b-2 border-darkg" href="http://lea.verou.me/">Lea Verou</a>, and using <a class="no-underline border-b-2 border-darkg" href="http://redux.js.org/">Redux</a> as an Observable of states, we need to rerender the editor as the text changes, keeping the syntax highlighting up to date. We keep the position of the cursor and the value of the editor in the Store, allowing the reducer to be responsible for the complex logic that handling special text editor keystrokes, like enter, tab, etc.</p>
<p class="font-ovo text-xl leading-normal pb-3">The issue is rendering the editor requires us to track &amp; reset the cursor, as we have to reset the text with the latest from the store and rehighlight it. If we do that while the user is typing, we have the potential to interrupt her, so we need to delay the render until the user is no longer typing. The render itself is scheduled in a <code class="whitespace-nowrap">requestAnimationFrame</code>, so if the user types before the next frame, we need to cancel the render request and wait until the user stops typing again. Otherwise, when the frame renders, the cursor will jump back to the position it was at when the render was scheduled.</p>
<p class="font-ovo text-xl leading-normal pb-3">So this is the problem we’re trying to solve.</p>
<p class="font-ovo text-xl leading-normal pb-3">In <a class="no-underline border-b-2 border-darkg" href="https://valtech-nyc.github.io/brookjs/"><code class="whitespace-nowrap">brookjs</code></a>, a component is just a function that takes a DOM element &amp; a stream of <code class="whitespace-nowrap">props$</code> and returns a stream of (usually <a class="no-underline border-b-2 border-darkg" href="https://github.com/acdlite/flux-standard-action">Flux Standard</a>) Actions from the element. Since we’re given an Observable of state, we’re able to get pretty fine control over exactly when the editor renders.</p>
<p class="font-ovo text-xl leading-normal pb-3">I’m using <a class="no-underline border-b-2 border-darkg" href="http://rpominov.github.io/kefir/">Kefir</a>, but the same concepts apply any other Observable implementation. Here’s how I solved this:</p>
<div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-javascript" data-filename="component.js"><code class="language-javascript"><span class="token keyword">import</span><span class="token space"> </span>Kefir<span class="token space"> </span><span class="token keyword">from</span><span class="token space"> </span><span class="token string">'kefir'</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">export</span><span class="token space"> </span><span class="token keyword">default</span><span class="token space"> </span><span class="token keyword">function</span><span class="token space"> </span><span class="token function">EditorComponent</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span><span class="token space"> </span>props$</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">const</span><span class="token space"> </span>keyup$<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span>Kefir<span class="token punctuation">.</span><span class="token function">fromEvents</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span><span class="token space"> </span><span class="token string">'keyup'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">const</span><span class="token space"> </span>keydown$<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span>Kefir<span class="token punctuation">.</span><span class="token function">fromEvents</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span><span class="token space"> </span><span class="token string">'keydown'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span>props$<span class="token punctuation">.</span><span class="token function">sampledBy</span><span class="token punctuation">(</span>keyup$<span class="token punctuation">.</span><span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">.</span><span class="token function">flatMapLatest</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token function">createRenderStream</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">takeUntil</span><span class="token punctuation">(</span>keydown$<span class="token punctuation">)</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">function</span><span class="token space"> </span><span class="token function">createRenderStream</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span>Kefir<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token parameter">emitter</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">const</span><span class="token space"> </span>loop<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>Update<span class="token space"> </span>the<span class="token space"> </span>element</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span>emitter<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token keyword">return</span><span class="token space"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>component.js</span></div></div></div></div>
<p class="font-ovo text-xl leading-normal pb-3">This problem is obviously solvable in a stateful way, with the view being responsible for holding onto a reference to the render loop, scheduling it in one event callback if a render isn’t scheduled and cancelling the render on the other if it is. We’re not talking about a huge component here, so there’s no reason to think managing this state would be difficult.</p>
<p class="font-ovo text-xl leading-normal pb-3">But as this component grows in complexity (and it will), colocating the temporal dependencies makes it very easy to reason about how the component changes over time. In the above example, how keyup and keydown events interact with the render cycle is explicit, rather than bouncing between callbacks or methods to see how animations are scheduled and cancelled. There’s zero chance of accidental cancellations or double renders.</p>
<p class="font-ovo text-xl leading-normal pb-3">Side effects, like updating the DOM, are wrapped in a stream, so they can be handled asynchonrously and cancelled, if needed. Because an Observable comes with its own cleanup code (the function returned at the end of <code class="whitespace-nowrap">stream</code>‘s callback), when the active Observable is switched, the animation frame request for the previous Observable is cancelled, ensuring the user isn’t interrupted as she types. The <code class="whitespace-nowrap">props$</code> stream has control over when the render happens, and <code class="whitespace-nowrap">flatMapLatest</code> ensures only the newest Observable is being observed at a time, so as the <code class="whitespace-nowrap">props$</code> emits new state, previous renders are also cancelled.</p>
<p class="font-ovo text-xl leading-normal pb-3"><code class="whitespace-nowrap">brookjs</code> provides some structure around this paradigm, but underneath, this is all that’s happening, and it provides some elegant solutions to thorny async problems. The canonical example is the autocomplete box, sending an AJAX request as a user types and cancelling the previous request. This is explained by Jafar Husain in <a class="no-underline border-b-2 border-darkg" href="https://www.youtube.com/watch?v=XE692Clb5LU">this great talk</a>.</p>
<p class="font-ovo text-xl leading-normal pb-3">Even after writing this article, the editor rendering continued to get more complicated, and handling it with Observables allowed me to focus on how particular events interacted with the render cycle, without worrying about how to manage what was actually <em>happening</em> at a given time. Let me know if you think the <a class="no-underline border-b-2 border-darkg" href="https://github.com/mAAdhaTTah/WP-Gistpen/blob/85a392c0e20da87610c0677e25c24ef00cba82b6/client/editor/instance/onMount.js#L196-L273">current implementation</a> is easy to understand.</p>
</section></article></div></div></div></div>