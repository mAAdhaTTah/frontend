<div id="__next"><div class="flex flex-row"><div class="print:hidden h-screen w-0 xl:w-88" style="width: 352px;"><header class="flex flex-col print:hidden fixed h-screen overflow-hidden w-inherit"><div class="h-screen overflow-hidden relative"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="background image" sizes="100vw" srcset="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;object-position:center center"><noscript><img alt="background image" sizes="100vw" srcSet="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2020%2F11%2Fheader-1.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;object-position:center center" loading="lazy"/></noscript></span></div><div class="absolute bg-etched rounded-lg text-center inline-flex lg:flex flex-row items-center justify-center lg:justify-start w-full max-w-xs sm:max-w-sm lg:max-w-md pin-center -mt-8 m-auto w-full"><div class="flex flex-row items-center justify-center w-full p-2"><div class="w-0 lg:w-48 h-48 rounded-full overflow-hidden flex-grow-0 transition-width ease-in-out lg:w-0"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="></span><img alt="avatar" srcset="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=384&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"><noscript><img alt="avatar" srcSet="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=384&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fstatic.jamesdigioia.com%2Fuploads%2F2015%2F02%2Fnew-avatar-sq.jpg&amp;w=750&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="font-muli lg:ml-5 flex-grow"><div class="text-4xl lg:text-5xl font-bold font-muli mb-3" data-typeit-id="1864915">James DiGioia<span class="ti-cursor" style="visibility: hidden;"></span></div><div class="text-xl md:text-3xl mb-3 flex flex-row align-center justify-center text-center"><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://www.facebook.com/james.digioia" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-4xl" style="color:#3b5998" alt="Facebook" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://www.linkedin.com/in/jamesdigioia" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-4xl" style="color:#4875b4" alt="LinkedIn" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="border-2 border-transparent focus:border-primary focus:outline-none" href="https://github.com/mAAdhaTTah/" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-4xl" style="color:#333" alt="GitHub" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></div><div class="relative text-xl lg:text-3xl" data-typeit-id="9062090">my little web home<span class="ti-cursor" style="visibility: hidden;"></span></div></div></div></div></header><div class="fixed top-2 left-2 z-50"><button class="rounded-full bg-darkg text-secondary p-1 border-2 border-darkg focus:outline-none focus:border-lightg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="text-lg" alt="" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg><div style="border:0;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;margin:0 -1px -1px 0;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap">Open menu</div></button></div></div><div class="relative flex-grow"><div style="opacity:1" class="absolute w-full"><article class="p-5 flow-root rounded pb-3 mb-5 max-w-xl mx-auto bg-primary"><header class="relative mb-5"><img src="https://static.jamesdigioia.com/uploads/2020/08/pitfall-trap.jpg" alt="" class=""><div class="absolute pin-x-center pin-y-bottom w-full bg-etched rounded p-5"><div class="text-center"><h1 class="text-4xl text-lightg font-muli mb-5">useEffect’s function dependency pitfall</h1></div><div class="flex justify-center"><div class="flex-grow-0 entry-meta my-2 flex items-center rounded bg-secondary p-3 mb-3"><time class="font-body published" datetime="2020-08-17T12:50:45">August 17th, 2020</time><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mx-3 w-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><p class="font-body">James DiGioia</p></div></div></div></header><section class="max-w-prose">
<p class="font-ovo text-xl leading-normal pb-3"><a class="no-underline border-b-2 border-darkg" href="https://reactjs.org/docs/hooks-effect.html"><code class="whitespace-nowrap">useEffect</code></a> is a powerful hook provided in React 16.8, allowing you to sync data with the outside world. One of the minor annoyances with <code class="whitespace-nowrap">useEffect</code> is its dependency array, which indicates to <code class="whitespace-nowrap">useEffect</code> when it should rerun. Adding a function to the dependency array can cause major problems with <code class="whitespace-nowrap">useEffect</code>. Let’s take a look at an example where adding a function <code class="whitespace-nowrap">useEffect</code>‘s dependency array causes problems for our React application.</p>



<h2 class="mb-5 font-muli text-3xl">A look at the problem</h2>



<p class="font-ovo text-xl leading-normal pb-3">The other day, I got a question from a developer on my team. She was working on some cart related functionality, and ESLint was complaining about the following code:</p>



<div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-javascript" data-filename="useEffect-issue.js"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token function">refreshCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token space"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>useEffect-issue.js</span></div></div></div></div>



<p class="font-ovo text-xl leading-normal pb-3"><code class="whitespace-nowrap">refreshCart</code> is a function that does exactly what it says: Refresh the cart &amp; save the data to <a class="no-underline border-b-2 border-darkg" href="https://reactjs.org/docs/context.html">Context</a>. The cart is something that’s used throughout the application, so we set it up as a Context for easy reuse. In this case, it was <code class="whitespace-nowrap"><a class="no-underline border-b-2 border-darkg" href="https://www.npmjs.com/package/eslint-plugin-react-hooks">eslint-plugin-react-hooks</a></code> warning about a missing dependency, the <code class="whitespace-nowrap">refreshCart</code> function.</p>



<h2 class="mb-5 font-muli text-3xl">A stroll through <code class="whitespace-nowrap">useEffect</code></h2>



<p class="font-ovo text-xl leading-normal pb-3">First, let’s talk about what the second parameter, the dependency array, is doing.&nbsp;<code class="whitespace-nowrap">useEffect</code>&nbsp;says “if any dependency in this array changes, rerun the effect”. Think about this as a “synchronization mechanism”, keeping your Component’s data &amp; some external side effect in sync with each other.</p>



<p class="font-ovo text-xl leading-normal pb-3">We have a great example of this in our app: On one page, we want to load a list of potential plans based on what the user has entered into the form. As the user changes the values in the form, we make a new API request to fetch those plans with <code class="whitespace-nowrap">useEffect</code>, keeping the latest request in sync with form data and cleaning up the previous request as we go.</p>



<p class="font-ovo text-xl leading-normal pb-3">So there are consequences to leaving values out of the dependency array. It can cause issues where the effect doesn’t run when you expect it to, or is running selectively when some data changes but needs to run when all of the data changes, or functions are running with stale data. The ESLint rules call this out so you can handle it.</p>



<h2 class="mb-5 font-muli text-3xl">The problem with <code class="whitespace-nowrap">refreshCart</code></h2>



<p class="font-ovo text-xl leading-normal pb-3">The reason this is annoying in&nbsp;<em>this</em>&nbsp;case is&nbsp;<code class="whitespace-nowrap">refreshCart</code>&nbsp;is defined within the scope of the component, so it’s&nbsp;<em>created fresh</em>&nbsp;on every render. If you were to just stuff it into the dependency array as it tells you, you’d get an infinite loop. On initial mount, the effect would call the function, which fetch the cart &amp; saves the data, triggering a render. When it does, it would see&nbsp;<code class="whitespace-nowrap">refreshCart</code><em> as a new reference</em>. <code class="whitespace-nowrap">useEffect</code>&nbsp;goes “oh hey, my dependency changed, I should rerun the effect”, starting the whole cycle over again.</p>



<p class="font-ovo text-xl leading-normal pb-3">Note that you only have this problem with functions created with in the component function. If you can hoist the function out of the component scope, ESLint will stop complaining because <code class="whitespace-nowrap">useEffect</code> will see the same function reference on every render.</p>



<p class="font-ovo text-xl leading-normal pb-3">We could do that in this case because <code class="whitespace-nowrap">refreshCart</code> saves the data to a <code class="whitespace-nowrap">useState</code> hook. This state is eventually passed into the Cart context mentioned earlier, so we need <code class="whitespace-nowrap">refreshCart</code> to be within the component scope so it has access to <code class="whitespace-nowrap">setCartContext</code>, the setter returned by <code class="whitespace-nowrap">useState</code>.</p>



<h2 class="mb-5 font-muli text-3xl">What we can do about it</h2>



<p class="font-ovo text-xl leading-normal pb-3">There are a couple solutions to this:</p>



<ol class="list-decimal pl-4 mb-5"><li class="mb-1 font-ovo text-xl">Wrap&nbsp;<code class="whitespace-nowrap">refreshCart</code>&nbsp;in&nbsp;<code class="whitespace-nowrap">useCallback</code>, a specialized version of&nbsp;<code class="whitespace-nowrap">useMemo</code>. Similar to <code class="whitespace-nowrap">useEffect</code>, <code class="whitespace-nowrap">useMemo</code> calls the callback provided whenever any of the dependencies changes, but instead of performing a side effect, it memoizes the return value. This is helpful for minimizing the number of times you recalculate a value as well as maintaining references between renders. In the latter case, <code class="whitespace-nowrap">useCallback</code> provides a specialized version of <code class="whitespace-nowrap">useMemo</code> for creating callbacks, where the function reference is reused if the dependencies haven’t changed.</li><li class="mb-1 font-ovo text-xl">Assign <code class="whitespace-nowrap">refreshCart</code> to a ref created with <code class="whitespace-nowrap">useRef</code>. ESLint doesn’t complain about ref usage in effects because they’re intentionally designed for mutable data. If you do this, you can create a singleton that you assign on first render and never touch again. If you mutate it further, it could cause issues in Concurrent Mode in the future. You can use this if you know for certain there are no dependencies or they will never change.</li><li class="mb-1 font-ovo text-xl">Tell eslint to shut up with&nbsp;<code class="whitespace-nowrap">eslint-disable-next-line</code>. Generally, eslint yells at you about these things for good reasons, so this is really a last resort if neither of the above solutions work for various reason. If you do go this route, you should always leave a comment as to why.</li></ol>



<h3 class="mb-5 font-muli text-2xl">Solution 1</h3>



<p class="font-ovo text-xl leading-normal pb-3">If we assume our <code class="whitespace-nowrap">refreshCart</code> function looks something like this:</p>



<div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-javascript" data-filename="refreshCart.js"><code class="language-javascript"><span class="token keyword">const</span><span class="token space"> </span><span class="token function-variable function">refreshCart</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>api<span class="token punctuation">.</span><span class="token function">getCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cart</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token function">setState</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>refreshCart.js</span></div></div></div></div>



<p class="font-ovo text-xl leading-normal pb-3">Then we can wrap the function in <code class="whitespace-nowrap">useCallback</code> like this:</p>



<div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-javascript" data-filename="refreshCart-useCallback.js"><code class="language-javascript"><span class="token keyword">const</span><span class="token space"> </span>refreshCart<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span>api<span class="token punctuation">.</span><span class="token function">getCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cart</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token function">setState</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token lf">
</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>refreshCart-useCallback.js</span></div></div></div></div>



<p class="font-ovo text-xl leading-normal pb-3">In this case, which is similar to our real application, we can leave out <code class="whitespace-nowrap">setCart</code> as a dependency. ESLint knows that <code class="whitespace-nowrap">setCart</code> will always be the same reference because <code class="whitespace-nowrap">useState</code> (as well as <code class="whitespace-nowrap">useReducer</code>) returns a stable function reference as the second value in the array. If your function has additional dependencies, ESLint can fix that for you automatically. Wrap your <code class="whitespace-nowrap">refreshCart</code> equivalent in <code class="whitespace-nowrap">useCallback</code> with an empty dependency array and run <code class="whitespace-nowrap">eslint --fix</code>.</p>



<h3 class="mb-5 font-muli text-2xl">Solution 2</h3>



<p class="font-ovo text-xl leading-normal pb-3">In the above example, we know for sure that everything we’re using in the function is a stable reference and won’t change over time. If you’re positive this is the case, and you know that won’t eventually change, you can instead assign the function to a ref with <code class="whitespace-nowrap">useRef</code>.</p>



<div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-javascript" data-filename="refreshCartRef.js"><code class="language-javascript"><span class="token keyword">const</span><span class="token space"> </span>refreshCartRef<span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">if</span><span class="token space"> </span><span class="token punctuation">(</span><span class="token operator">!</span>refreshCartRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span>refreshCartRef<span class="token punctuation">.</span><span class="token function-variable function">current</span><span class="token space"> </span><span class="token operator">=</span><span class="token space"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span><span class="token space"> </span>api<span class="token punctuation">.</span><span class="token function">getCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cart</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token function">setState</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token lf">
</span><span class="token lf">
</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span>refreshCartRef<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token space"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>refreshCartRef.js</span></div></div></div></div>



<p class="font-ovo text-xl leading-normal pb-3">Couple of things to be aware of here:</p>



<ol class="list-decimal pl-4 mb-5"><li class="mb-1 font-ovo text-xl">We only create the function once, the first time the reference is created. On future renders, <code class="whitespace-nowrap">refreshCart.current</code> will point to the same function reference as the initial render, so the <code class="whitespace-nowrap">if</code> block won’t run. This <em>will</em> cause a problem if <code class="whitespace-nowrap">refreshCart</code> references values outside of its scope that change over time. This is know as the “stale closure problem”. One way you can avoid this problem is using the callback form of <code class="whitespace-nowrap">setState</code>, which eliminates the dependency on the state value itself.</li><li class="mb-1 font-ovo text-xl">You <em>must</em> use the ref directly in <code class="whitespace-nowrap">useEffect</code> in order to keep ESLint from complaining. Because ESLint knows that refs are designed for mutable data, it knows not to include them in <code class="whitespace-nowrap">useEffect</code>‘s dependency array.</li></ol>



<p class="font-ovo text-xl leading-normal pb-3">The “stale closure problem” is a big potential issue here, so it’s worth emphasizing: You <em>will</em> end up with unexpected behaviors if you rely on <code class="whitespace-nowrap">useState</code> values, props, or other changing values within your <code class="whitespace-nowrap">refreshCart</code>. This is because the <a class="no-underline border-b-2 border-darkg" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures">closure captures the values in its scope</a>. Because the function is never recreated, it never captures the updated values in its scope. Hence “stale closure problem.”</p>



<h3 class="mb-5 font-muli text-2xl">Solution 3</h3>



<p class="font-ovo text-xl leading-normal pb-3">As a last resort, and if you know exactly what you’re doing and what the consequences are, you can always tell ESLint to leave you alone. If you choose to go this route, be sure to leave a comment explaining <em>why</em>, so future you knows what the thinking was. Additionally, you should disable the specific rule that ESLint is complaining about, so if that part of the code has additional problems, ESLint will still complain about them.</p>



<div class="mb-5"><div class="code-toolbar"><pre class="line-numbers language-javascript" data-filename="refreshCart-eslint-disable.js"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token space"> </span><span class="token operator">=&gt;</span><span class="token space"> </span><span class="token punctuation">{</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token function">refreshCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>refreshCart<span class="token space"> </span>is<span class="token space"> </span>recreated<span class="token space"> </span>fresh,<span class="token space"> </span>but<span class="token space"> </span>we<span class="token space"> </span>only<span class="token space"> </span>want<span class="token space"> </span>to</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>do<span class="token space"> </span>this<span class="token space"> </span>on<span class="token space"> </span>initial<span class="token space"> </span>render,<span class="token space"> </span>so<span class="token space"> </span>we're<span class="token space"> </span>going<span class="token space"> </span>to<span class="token space"> </span>provide</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>an<span class="token space"> </span>empty<span class="token space"> </span>array<span class="token space"> </span>here<span class="token space"> </span>so<span class="token space"> </span>it<span class="token space"> </span>only<span class="token space"> </span>runs<span class="token space"> </span>once.</span><span class="token lf">
</span><span class="token space"> </span><span class="token space"> </span><span class="token comment">//<span class="token space"> </span>eslint-disable-next-line<span class="token space"> </span>react-hooks/exhaustive-deps</span><span class="token lf">
</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token space"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button type="button">Copy</button></div><div class="toolbar-item"><span>refreshCart-eslint-disable.js</span></div></div></div></div>



<p class="font-ovo text-xl leading-normal pb-3">Now, if you come back to this, you know why this rule was disabled, what the purpose is, and whether that logic still applies. If you’re making changes to <code class="whitespace-nowrap">refreshCart</code>, you may want to refactor this code into one of the above solutions.</p>



<h2 class="mb-5 font-muli text-3xl">Conclusion</h2>



<p class="font-ovo text-xl leading-normal pb-3">The ESLint plugin is incredibly helpful for catching situations like this, and with these tools in your tool belt, you can choose the best answer for your situation. I would also argue this is the preference order for these 3 solutions; do <code class="whitespace-nowrap">useCallback</code> first. There are good reason to use the other two, and you should have them available to you, but all of these are dependent on <em>how the code will change</em>. The less likely it is to change, the further down the list you can go. However, <code class="whitespace-nowrap">useCallback</code> (&amp; <code class="whitespace-nowrap">useMemo</code>!) leans <em>into</em> the way hooks are designed, with the dependency array linking everything all the way back. That’s why it’s the best solution for the common case and what you should reach for first.</p>
</section></article></div></div></div></div>